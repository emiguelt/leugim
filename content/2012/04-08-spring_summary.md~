---
kind: article
title: Resumen Spring
created_at: 2012/04/08
excerpt: Resumen del Framework Spring
tags: [spring, wdt, web, java]
---

Este es un resumen del framework de desarrollo Java (principalmente Web) Spring, basado en el libro <a href="http://www.manning.com/walls4/" target="_blank">Spring in Action, Third Edition</a>

# Spring
Framework de desarrollo Java que ofrece _Dependency Injection_, _Aspect Oriented Programming_ y _Templates_. 

 * Inyección de Dependencias (DI): Configuración automático de dependencias de una clase.
 * Programación Orientada a Aspectos: Adición de funcionalidades comunes a lo largo de un sistema (ej. Sistema de Logging).
 * Plantillas: Permiten reutilizar código y reducir escribir funciones repetitivas.

Spring administra clases en un sistema por medio de un _Container_, en este contenedor se encuentran todas las referencias de los objetos administrados por Spring. Hay dos tipos de contenedores, los _BeanFactories_, para inyección de dependencia, y _ApplicationContexts_, que incluyen DI ademas de otros servicios Event Listeners, interceptors, etc.  

_ApplicationContexts_ relevantes en Spring:

 * ClassPathApplicationContext: en classpath
 * FileSystemApplicationContext: en el sistema de archivos
 * XmlWebApplicationContext: para aplicaciones web

## Ciclo de vida de un Bean
Un Bean es una clase POJO administrada por Spring. 

Ciclo de vida:

 * Instantiate
 * PopulateProperties
 * BeanNameAware's setBeanName
 * BeanFactoryAware's setBeanFactory
 * ApplicationContextAware's setApplicationContext
 * Pre-initialization BeanPostProcessors
 * InitializatingBean's afterPropertiesSet
 * Call custom init method
 * Post-initialization BeanPostProcessors
 *  **BEAN READY TO USE**
 * Container is shutdown
 * DisposableBean's destroy
 * Call custom destroy method


## Configuración de Beans
### Constructor injection
    <bean id="beanId1" class="package.Class">
      <constructor-arg value="10"/>
      <constructor-arg ref="beanId2"/>
    </bean>
    ...
    <bean id="beanId2" class="package.Class2"/>
### Factory Method injection
    <bean id="beanId1" class="package.Class" factory-method="getInstance"/>

**Nota**: Bean son Singleton por default, el atributo _prototype_ se utiliza para sobrescribir este patrón. Opciones posibles: singleton, prototypee, request, session, global-session.

### Init/Destroy beans
    <bean id="beanId1" class="package.Class"
    init-method="methodWhenInit" destroy-method="methodWhenDestroy"/>

 * Otro método para inicializar o finalizar un bean es implementando las interfaces _InitializingBean y DisposableBean_.
 * También se puede configurar un método default para inicializar y finalizar de forma global configurando _default-init-method_ y _default_destroy_method_ como atributos del tag _beans_.

### Properties injection
    <bean id="beanId1" class="package.Class">
      <property name="property1" value="10"/>
      <property name="property2" ref="beanId2"/>
    </bean>
    ...
    <bean id="beanId2" class="package.Class2"/>
### Inner beans
    <bean id="beanId1" class="package.Class">
      <property name="property2">
        <bean class="package.Class2"/>
      </property>
    </bean>

Funciona igual para `contructor-arg`
### Wiring Collections
#### List, sets, arrays
    <bean id="beanId1" class="package.Class">
      <property name="mycollection">
        <list>
          <ref bean="beanId2"/>
          <ref bean="beanId3"/>
          <ref bean="beanId4"/>
        </list>
      </property>
    </bean>
#### Maps, Props
    <bean id="beanId1" class="package.Class">
      <property name="mycollection">
        <map>
          <entry key="aKey" value="aValue"/>
          <entry key-ref="keyBean" value-ref="beanId3"/>
          <entry key="aKey" value-ref="beanId2"/>
        </list>
      </property>
    </bean>
### Wiring to NULL
    <property name="thisPropNull"><null/></property>

## Autowiring
Básicamente, hay dos tipos de resolución automática de beans: "autowire" en el XML o usando "annotations".
### Autowiring in XML
Durante la configuración de un bean en el _ApplicationContext_ se define el tipo de "autowire", es de decir, como son conectadas las propiedades de un bean.

    <bean ... autowire='TIPO_DE_AUTOWIRE' />

#### Tipos de _Autowire_
 * byName: busca un bean con el mismo NOMBRE de la propiedad (atributo)
 * byType: busca un bean con el mismo TIPO de la propiedad, si hay varios beans que puedan ser seleccionados, se genera una excepción, a menos que hay solo un bean marcado como "_primary_", por default, todos los beans son _primary=true_, se debe marcar _primary=false_ para evitar la excepción.
 * constructor: igual que _byType_ pero para los parametros del constructor
 * autodetect: realiza _constructor_ y si no es posible, realiza _byType_

Para definir _autowire_ para todos los beans se usa: `<beans ... default-autowire='TIPO_DE_AUTOWIRE' />`, en este caso también esta la opción _none_.

### Autowiring with Annotations
Para habilitar las _anotaciones_ se coloca el elemento `<context:annotation-config/>` en el tag `<beans>`.

#### @Autowired
La anotacion_@Autowired_ colocada en atributos o métodos informa a Spring que esa propiedad debe ser configurada por el _Framework_. 
 * _@Autowired_ es equivalente a _@Inject_ en la especificación JSR-330.
 * _@Autowired_ es equivalente a _Autowire byType_
 * (required=false): parametro opcional para evitar la generación de excepciones en el caso que no sea posible suplir la dependencia.
 * _@Qualifier("name")_: Usado para eliminar la ambigüedad en la resolución de dependencias (Similar a _byName_). Equivalente a _@Named("name") en la especificación Java.
 * _Qualifiers_ pueden ser extendidos en Spring o en Java
 * _@Value("xyz")_: Usado para pasar valores a la propiedad. Usado principalmente con _Spring Expression Language_ (SpEL).

Hasta aquí, los beans (anotados o no) debían estar listados en el _applicationContext_, para evitar esto se usa el _descubrimiento automático de beans_.

### Descubrimiento automático de Beans
Se usa `<context:component-scan/>` en vez de `<context:annotation-config/>`. se debe configurar el atributo `base-package="xyz.abc"` para indicar donde deben ser buscados los beans. Los Beans pueden ser de 4 tipos:

* _@Component("nombre_opcional")_:  Bean común de Spring.
* _@Controller("nombre_opcional")_: Controlador de Spring MVC
* _@Service("nombre_opcional")_: Servicio de Spring
* _@Repository("nombre_opcional")_: Repositorio de accesso a datos (similar a DAOs)

## Configuración de Spring usando Java
Se usa una clase Java para obtener la configuración de los beans. La clase debe estar anotada con _@Configuration_ y cada método que genera un bean debe ser anotada con _@Bean_. También se utiliza `<context:component-scan/>`.
